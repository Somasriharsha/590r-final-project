---
title: "Final_Project"
format: html
editor: visual
echo: false
---
## EPI 590R Final Project, Sri Harsha 

1. Loading the data

```{r}
#| message: false
#| echo: true

library(tidyverse)
library(gtsummary)
library(here)

opt <- get(load(here::here("data","opt.rda")))

opt$group_cat <- factor(opt$Group, levels = c("C", "T"), labels = c("Control", "Treatment"))

```

This dataset contains `r nrow(opt)` participants. `r sum(opt$Group == "C")` were in the control group and `r sum(opt$Group == "T")` were in the Treatment group.


2. Creating a descriptive statistics table from the  data
```{r}
#| label: tbl-summary
#| tbl-cap: "Descriptive statistics by study group"

opt_table <- tbl-summary(data = opt,
                         by = group_cat,
                         include = c(Age, BMI, Use.Tob, Use.Alc, EDC.necessary., Completed.EDC),
                         label = list(
                           Age ~ "Age",
                           BMI ~ "Body Mass Index",
                           Use.Tob ~ "Tobacco Use",
                           Use.Alc ~ "Alcohol Use",
                           EDC.necessary. ~ "Necessary Essential Dental Care",
                           Completed.EDC ~ "Completed Essential Dental Care"
  )
) |>
  add_overall(col_label = "**Total** N = {N}") |>
  bold_labels()

as_gt(opt_table)

saveRDS(opt_table, here("data", "opt_table.rds"))

```

```{r}
stats <- list(n = nrow(opt),
              mean_age = mean(opt$Age))
```
There were `r stats$n` participants in the study with a mean age of `r stats$mean_age`.

@tbl-summary for the descriptive statistics of the study participants.

3. Regression model
```{r}
tbl_uvregression(opt, 
  y = Prev.preg,
  include = c(Age, Education,  Use.Tob, Use.Alc,V3.PD.avg),
  method = glm,
  method.args = list(family = binomial()),
  exponentiate = TRUE)
```

4.  Figure: Histogram of BMI
```{r}
#| label: fig-hist
#| fig-cap: "Distribution of BMI"
hist(opt$BMI, main = "Distribution of BMI", xlab = "BMI")

ggsave(here("data", "BMI_distribution.jpg"))

```
@fig-hist for the BMI distribution of the study participants.

5. Creating a function and using it.
```{r}
bmi_category <- function(x) {
  mean_bmi <- mean(opt$BMI, na.rm = TRUE)
  ifelse(x >= mean_bmi, 
         "Above or Equal to Mean BMI", 
         "Below Mean BMI")
}
print("BMI category of the first 5 participants:")
bmi_category(opt$BMI[1:5])
```


6a. Inline R code - 1 pulling a statistic from a table and 1 printing something else. 

```{r}
edc_total_yes <- gtsummary::inline_text(
  opt_table, variable = "Completed.EDC", level = "Yes", column = "stat_0"
)

bmi_control <- gtsummary::inline_text(
  opt_table, variable = "BMI", column = "stat_1"   # stat_1 = Control, stat_2 = Treatment
)

alc_yes_treat <- gtsummary::inline_text(
  opt_table, variable = "Use.Alc", level = "Yes", column = "stat_2"
)

```
Overall, `r edc_total_yes` completed essential dental care.  
In the control group, BMI was `r bmi_control`.  

Among treatment participants, alcohol use “Yes” was `r alc_yes_treat`.

Tobacco use was reported by `r round(100 * mean(opt$Use.Tob == "Yes", na.rm = TRUE), 1)`% of participants.

Mean pocket depth at Visit 3 was `r round(mean(opt$V3.PD.avg, na.rm = TRUE), 2)` mm.
